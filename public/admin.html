<!DOCTYPE html>
<html lang="te">
  <head>
    <meta charset="UTF-8" />
    <title>‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞™‡±á‡∞ú‡±Ä</title>
  </head>
  <body>
    <h2>üîê ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞™‡∞æ‡∞®‡±Ü‡∞≤‡±ç</h2>

    <div id="passwordDiv">
      <label>‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø:</label>
      <input type="password" id="passwordInput" />
      <button onclick="checkPassword()">‡∞∏‡∞¨‡±ç‡∞Æ‡∞ø‡∞ü‡±ç</button>
      <p id="passError" style="color: red"></p>
    </div>

    <div id="formDiv" style="display: none">
      <form id="donationForm">
        <label>‡∞™‡±á‡∞∞‡±Å:</label>
        <input type="text" id="donorName" required />
        <label>‡∞¶‡∞æ‡∞®‡∞Ç ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç:</label>
        <input type="number" id="donationAmount" required />
        <button type="submit">‡∞∏‡∞¨‡±ç‡∞Æ‡∞ø‡∞ü‡±ç</button>
      </form>
      <p id="formMsg" style="color: green"></p>

      <button id="clearBtn">üßπ ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ü‡±ç‡∞∞‡±Ä‡∞≤‡±Å ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡±Å</button>
      <p id="clearMsg" style="color: red"></p>

      <h3>üìã ‡∞¶‡∞æ‡∞®‡∞æ‡∞≤‡±Å</h3>
      <ul id="donationList"></ul>
    </div>

    <script>
      const ADMIN_PASSWORD = "kogatam2025";

      function checkPassword() {
        const input = document.getElementById("passwordInput").value;
        if (input === ADMIN_PASSWORD) {
          document.getElementById("passwordDiv").style.display = "none";
          document.getElementById("formDiv").style.display = "block";
          loadDonations();
        } else {
          document.getElementById("passError").innerText = "‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç ‡∞§‡∞™‡±ç‡∞™‡±Å";
        }
      }

      document
        .getElementById("donationForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const name = document.getElementById("donorName").value;
          const amount = parseFloat(
            document.getElementById("donationAmount").value
          );

          const res = await fetch("/api/donations", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, amount, password: ADMIN_PASSWORD }),
          });

          const data = await res.json();
          document.getElementById("formMsg").innerText = data.success
            ? "‡∞¶‡∞æ‡∞®‡∞Ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø"
            : data.error;

          loadDonations();
        });

      document
        .getElementById("clearBtn")
        .addEventListener("click", async () => {
          const confirmed = confirm("‡∞®‡∞ø‡∞ú‡∞Ç‡∞ó‡∞æ ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ü‡±ç‡∞∞‡±Ä‡∞≤‡±Å ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞æ?");
          if (!confirmed) return;

          const res = await fetch("/api/donations", {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ password: ADMIN_PASSWORD }),
          });

          const data = await res.json();
          document.getElementById("clearMsg").innerText = data.success
            ? "‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ü‡±ç‡∞∞‡±Ä‡∞≤‡±Å ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±ç‡∞°‡∞æ‡∞Ø‡∞ø"
            : data.error;

          loadDonations();
        });

      async function loadDonations() {
        const res = await fetch("/api/donations");
        const data = await res.json();

        const list = document.getElementById("donationList");
        list.innerHTML = "";

        data.forEach((donation) => {
          const li = document.createElement("li");
          li.innerHTML = `${donation.name} - ‚Çπ${donation.amount} 
          <button onclick="deleteEntry(${donation.id})">‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡±Å</button>`;
          list.appendChild(li);
        });
      }

      async function deleteEntry(id) {
        const confirmed = confirm("‡∞®‡∞ø‡∞ú‡∞Ç‡∞ó‡∞æ ‡∞à ‡∞é‡∞Ç‡∞ü‡±ç‡∞∞‡±Ä ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞æ?");
        if (!confirmed) return;

        const res = await fetch(`/api/donations/${id}`, {
          method: "DELETE",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ password: ADMIN_PASSWORD }),
        });

        const data = await res.json();
        alert(data.message || data.error);
        loadDonations();
      }
    </script>
  </body>
</html>
